<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta http-equiv=" X-UA-Compatible" content="ie=edge">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏±‡∏á‡∏Ñ‡πå | KepTung">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏±‡∏á‡∏Ñ‡πå | KepTung</title>

    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="asset/icon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="asset/icon/favicon-16x16.png">
    <link rel="manifest" href="asset/icon/site.webmanifest">
    <link rel="icon" type="image/png" sizes="32x32" href="asset/icon/favicon-32x32.png">

    <!-- splash_screen -->
    <link href="asset/splashscreens/iphone6_splash.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="asset/splashscreens/iphoneplus_splash.png" media="(device-width: 621px) and (device-height: 1104px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image" />
    <link href="asset/splashscreens/iphonex_splash.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image" />
    <link href="asset/splashscreens/iphonexr_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="asset/splashscreens/iphone5_splash.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="asset/splashscreens/iphonexsmax_splash.png" media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)" rel="apple-touch-startup-image" />
    <link href="asset/splashscreens/ipad_splash.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="asset/splashscreens/ipadpro1_splash.png" media="(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="asset/splashscreens/ipadpro3_splash.png" media="(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />
    <link href="asset/splashscreens/ipadpro2_splash.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)" rel="apple-touch-startup-image" />

    <!-- css -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Kanit&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- icon -->
    <script src="https://unpkg.com/feather-icons"></script>

    <style>
        body {
            background: #eeeeee;
            font-family: 'Kanit', sans-serif;
        }

        nav {
            background: #13A699;
            color: white;
            text-align: left;
            padding: .5em;
            position: absolute;
            left: 0;
            right: 0;
        }

        .page {
            padding: 1em;
            padding-top: 40px;
        }

        button {
            border-radius: .3em;
            font-size: 1rem;
            color: white;
            width: 100%;
            padding: 1em;
            box-sizing: border-box;
            border: none;
        }

        button:hover {
            cursor: pointer;
        }

        input {
            width: 100%;
            border-radius: .3em;
            font-size: 1rem;
            padding: .5em .5em;
            box-sizing: border-box;
            border: 1px solid #ccc;
            margin-bottom: 1em;
        }

        .saving {
            text-align: center;
        }

        .detail {
            margin-bottom: 40px;
            margin-top: 40px;
        }

        #page-setting,
        #page-detail {
            display: none;
        }

        #list_goal {
            height: 340px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        #page-home, #page-detail {
            padding-bottom: 5px;
        }

        #goal_item{
            /* background-color: #13a69936; */
            background-color: #eeeeee;
            padding: 1em;
            margin-bottom: 10px;
            overflow-x: auto;
            border-radius: 5px;
        }

        .btn {
            color: white;
        }
        .btn-green {
            background: #13A699;
            color:white;
        }

        .btn-green:hover {
            color:white;
        }

        .btn-grey {
            background-color: #eeeeee;
            color: #000;
        }

        .btn-link {
            border: solid 1px;
            margin: 5px 0px 5px 0px;
        }

        .col-4 {
            text-align: -webkit-center;
            padding-left: 0px;
            padding-right: 0px;
        }

        .col-8 {
            padding-right: 0px;
        }

        svg {
            width: 20px;
        }
    </style>
</head>

<body>
    <div class='container-fluid bg-light col-md-6'>
        <nav>KepTung üí∞</nav>
        
        <div id="page-home" class="page">
            <h3 style="margin-top: 10px;">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏±‡∏á‡∏Ñ‡πå</h3>
            <div id="list_goal"></div>
            <button class="btn btn-green" id="Addbtn" onclick="mockupClick('page-home','page-setting')">
                <i data-feather="file-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</button>
            <button class="btn btn-link text-danger" id="removeAll" onclick="removeAll()">
                <i data-feather="trash-2"></i> ‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        </div>

        <div id="page-setting" class="page">
            <h3 style="margin-top: 10px;">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏±‡∏á‡∏Ñ‡πå</h3>
            <input type='text' id='goal' placeholder='‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢'></input>
            <input type="number" id='amount' placeholder='‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô'></input>
            <div class="row">
                <div class="col-6">
                    <label for="Inputstartdate">‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                    <input type='date' id='startdate' onchange="handleDataChange('startdate', this.value)"></input>
                </div>
                <div class="col-6">
                    <label for="inputenddate">‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                    <input type='date' id='enddate' onchange="handleDataChange('enddate', this.value)"></input>
                </div>
            </div>
            <label for="inputfrequency">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà</label>
            <select id="frequency" class="form-control">
                <option value="‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</option>
                <option value="‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå">‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option>
                <option value="‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
            </select><br>
            <button class="btn btn-green" onclick="Calculate()"><i data-feather="save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            <button class="btn btn-grey" style="margin-top: 10px;" id="backbtn" onclick="mockupClick('page-setting','page-home')">
                <i data-feather="menu"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
        </div>

        <div id="page-detail" class="page">
            <h1 style="margin: 10px;" id='curgoal' class="text-center"></h1>
            <div class="row">
                <div class="col-6">
                    <div id='showdate'></div>
                    <div id='day_count'></div>
                </div>
                <p id='countdowndate' class="text-right col-6">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å <br></p>
            </div>

            <div class="saving">
                <small>‡∏¢‡∏≠‡∏î‡πÄ‡∏Å‡πá‡∏ö/‡∏Ñ‡∏£‡∏±‡πâ‡∏á</small>
                <h1 id='saving_amount' style="color: #7CB342;"></h1><small id='showfrequency'></small>
            </div>

            <div class="detail">
                <div class="progress">
                    <div id='progress_bar' class="progress-bar progress-bar-striped bg-success" role="progressbar"
                        aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <div class="row">
                    <div id='store_amount' class="col-6"></div>
                    <div id="goal_amount" class="col-6" style="text-align:right;"></div>
                </div>
            </div>
            <button class="btn btn-grey" id="backbtn" onclick="mockupClick('page-detail','page-home')">
                <i data-feather="menu"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            <button class="btn btn-link text-danger" type="button" class="btn btn-outline-danger" id="removeItembtn" onclick="removeGoal(getIndex)">
                <i data-feather="trash-2"></i> ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ</button>
        </div>
    </div>
    <div class="footer text-right mt-2 p-2 text-dark text-center">
        <small>*‡πÄ‡∏®‡∏©‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</small><br>
        <small>KepTung by <a href="https://web.facebook.com/aomxsyn" style="color:#13A699">aomsyn</a> üßÉ</small>
    </div>

    <script>
    
    // icon
    feather.replace()
    
    // set_localStorage
    if (localStorage.getItem("KeptungData") === null){
        localStorage.setItem("KeptungData", "[]");
    }
    KeptungData = JSON.parse(localStorage.KeptungData);

    var calAmount = 0;
    var calPass = 0;
    var calDiff = 0;
    var calLeft = 0;
    var getIndex = 0;

    // insert_data_into_localStorage
    function addItem(){
        let title = document.getElementById("goal").value;
        let amount = document.getElementById("amount").value;
        let startdate = document.getElementById("startdate").value;
        let enddate = document.getElementById("enddate").value;
        let freq = document.getElementById('frequency').value;
        if (title != "" && amount > 0 && startdate != "" && enddate != "" && freq != ""){
            KeptungData.push({"title": title, "amount": parseInt(amount), "frequency": freq, "startDate": startdate, "endDate": enddate, "calDiff": calDiff, "calPass": calPass, "calLeft": calLeft, "calAmount": calAmount});
            document.getElementById("goal").value = "";
            document.getElementById("amount").value = "";
            document.getElementById("startdate").value = "";
            document.getElementById("enddate").value = "";
            

            if (new Date(startdate) > new Date(enddate)) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
            } else {
                mockupClick('page-setting', 'page-home');
                displayGoal()
                location.href=location.href
            }
        } else {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
        }
    }

    // date_change
    function handleDataChange(type, e) {
        if (type == 'startdate') {
            enddate.min = e
        } else {
            startdate.max = e
        }
    }

    // show_all_goal
    function displayGoal(){
        KeptungData.forEach((element, index) => {
            let start = new Date(element.startDate);
            let end = new Date(element.endDate);
            let sdate = start.getDate() + '/' + (start.getMonth()+1) + '/' + start.getFullYear();
            let edate = end.getDate() + '/' + (end.getMonth()+1) + '/' + end.getFullYear();
            list_goal.innerHTML += `
                <div id="goal_item" class="${element.calAmount*element.calPass >= element.amount ? 'text-success': ""}" onclick="showdetail(${index})">
                    <div class="row">
                        <div class="col-6">
                            <h5>${element.title}</h5>
                        </div>
                        <div class="col-6">
                            <h5 class="text-right">${element.amount}‡∏ø</h5>
                        </div>
                        <div class="col-8">
                            <small>${sdate} - ${edate}</small>
                        </div>
                        <div class="col-4">
                            <small class="text-right">(${element.frequency == '‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô' ? element.calDiff + ' ‡∏ß‡∏±‡∏ô' : element.frequency == '‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå' ? element.calDiff + ' ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå' : element.calDiff + ' ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô'})</small>
                        </div>
                        <div class="col-8">
                            <small>${element.calAmount*element.calPass >= element.amount ? 'üéâ Success': 'üöß In progress'}</small>
                        </div>
                    </div>
                </div>
                `;
            
        });
        
        console.log(KeptungData);
        localStorage.setItem("KeptungData", JSON.stringify(KeptungData));
    }
    displayGoal()
    

    // remove_selected_goal
    function removeGoal(index){
        if(confirm('‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà')){
            remove = KeptungData.splice(index, 1);
            location.href=location.href
            displayGoal(); 
            mockupClick('page-detail','page-home')
        }
    }

    // remove_all_goal_from_localStorage
    function removeAll(){
        if(confirm(`‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å`)){
            localStorage.clear();
            location.href=location.href
        }
    }

    // change_page
    function mockupClick(pageToHide, pageToShow) {
        document.querySelector('#' + pageToHide).style.display = "none";
        document.querySelector('#' + pageToShow).style.display = "block";
    }

    // calculate_saving_amount
    function Calculate(){
        var startList = [];
        var endList = [];

        var InputAmount = parseInt(amount.value);
        var frequency = document.getElementById("frequency").value;

        var StartDate = new Date(startdate.value);
        var EndDate = new Date(enddate.value);
        var CurrentDate = new Date();
        
        startList.push(StartDate.getFullYear(), StartDate.getMonth()+1, StartDate.getDate());
        endList.push(EndDate.getFullYear(), EndDate.getMonth()+1, EndDate.getDate());

        if(frequency == "‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô"){
            console.log(frequency);
                var DayPass = 0; 
                var DayDiff = 0;
                var DayLeft = 0;
                var DailyAmount = 0;

                if (EndDate >= StartDate){
                    DayDiff = (EndDate - StartDate);
                    DayDiff = DayDiff/(3600 * 24 * 1000)+1;
                    calDiff = DayDiff;
                }

                DayPass = Math.ceil((CurrentDate - StartDate)/(3600 * 24 * 1000));
                calPass = DayPass;
                DayLeft = DayDiff - DayPass;
                calLeft = DayLeft;
                
                DailyAmount = Math.ceil(InputAmount/DayDiff);
                calAmount = DailyAmount;

        } else if(frequency == "‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå"){
            var WeekDiff = Math.round((EndDate - StartDate) / (7 * 24 * 3600 * 1000));
            calDiff = WeekDiff;

            var WeekPass = Math.round((CurrentDate - StartDate) / (7 * 24 * 3600 * 1000));
            calPass = WeekPass;

            var WeekLeft = WeekDiff - WeekPass;
            calLeft = WeekLeft;

            var WeeklyAmount = Math.ceil(InputAmount/WeekDiff);
            calAmount = WeeklyAmount;

        } else if(frequency == "‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"){
            var MonthDiff = 0;
            MonthDiff = (endList[0] - startList[0]) * 12;
            MonthDiff -= startList[1];
            MonthDiff += endList[1];

            if(MonthDiff <= 0){
                MonthDiff = 0;
            } else {
                MonthDiff = MonthDiff;
            }

            calDiff = MonthDiff;
            MonthPass = (CurrentDate.getFullYear() - startList[0])*12;
            MonthPass -= startList[1];
            MonthPass += (CurrentDate.getMonth()+1);
            calPass = MonthPass;
            MonthLeft = MonthDiff - MonthPass;
            calLeft = MonthLeft;

            var MonthlyAmount = Math.ceil(InputAmount/MonthDiff);
            calAmount = MonthlyAmount;
        }
        addItem();
    }

    //show_goal_detail
    function showdetail(index) {
            getIndex = index;
            curgoal.innerHTML = KeptungData[index].title;
            showfrequency.innerHTML = '(' + KeptungData[index].frequency + ')';
            goal_amount.innerHTML = KeptungData[index].amount;

            if(KeptungData[index].frequency == "‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô"){
                countdowndate.innerHTML = '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å<br>' + KeptungData[index].calLeft + ' ‡∏ß‡∏±‡∏ô';
                day_count.innerHTML = 'D-' + KeptungData[index].calPass;
            } else if(KeptungData[index].frequency == "‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå"){
                countdowndate.innerHTML = '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å<br>' + KeptungData[index].calLeft + ' ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå';
                day_count.innerHTML = 'W-' + KeptungData[index].calPass;
            } else {
                countdowndate.innerHTML = '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å<br>' + KeptungData[index].calLeft + ' ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô';
                day_count.innerHTML = 'M-' + KeptungData[index].calPass;
            }

            saving_amount.innerHTML = KeptungData[index].calAmount;
            store_amount.innerHTML = KeptungData[index].calAmount *KeptungData[index].calPass;
            var percent = Math.ceil(((KeptungData[index].calAmount *KeptungData[index].calPass)/KeptungData[index].amount *100));
            progress_bar.style.width = percent + '%';
            progress_bar.innerHTML = percent + '%';
            getNowDate();
            mockupClick('page-home', 'page-detail');
    }

    //get_today_date
    function getNowDate() {
        var currentDate = new Date();
        document.getElementById('showdate').innerHTML = ("0" + currentDate.getDate()).slice(-2) + "/" + ("0"+(currentDate.getMonth()+1)).slice(-2) + "/" + currentDate.getFullYear();
    }

    </script>
</body>
</html>