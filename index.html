<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta http-equiv=" X-UA-Compatible" content="ie=edge">

    <meta name="theme-color" content="#13A699" />

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="KepTung">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <title>‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏±‡∏á‡∏Ñ‡πå | KepTung</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Kanit&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        body {
            /* padding: 1em; */
            background: #eeeeee;
            /* background-color: #404040; */
            font-family: 'Kanit', sans-serif;
        }

        nav {
            background: #13A699;
            color: white;
            text-align: left;
            padding: .5em;
            position: absolute;
            left: 0;
            right: 0;
        }

        .page {
            padding: 1em;
            padding-top: 60px;
        }

        button {
            background: #13A699;
            border-radius: .3em;
            font-size: 1rem;
            color: white;
            width: 100%;
            padding: 1em;
            box-sizing: border-box;
            border: none;
        }

        button:hover {
            cursor: pointer;
        }

        input {
            width: 100%;
            border-radius: .3em;
            font-size: 1rem;
            padding: .5em .5em;
            box-sizing: border-box;
            border: 1px solid #ccc;
            margin-bottom: 1em;
        }

        .saving {
            text-align: center;
        }

        .detail {
            margin-bottom: 40px;
            margin-top: 40px;
        }

        #page-setting,
        #page-saving {
            display: none;
        }

        #list_goal {
            height: 410px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        #goal_item{
            background-color: #13a69936;
            padding: 1em;
            margin-bottom: 10px;
        }

        #backbtn{
            margin-top: 5px;
            background-color: #eeeeee;
            color: #000;
        }
    </style>
</head>

<body>
    <div class='container-fluid bg-light col-md-6'>
        <nav>KepTung üí∞</nav>
        
        <div id="page-home" class="page">
            <h2>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
            <div id="list_goal"></div>
            
            <button id="Addbtn" onclick="mockupClick('page-home','page-setting')">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</button>
        </div>

        <div id="page-setting" class="page">
            <h3>‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏ï‡∏±‡∏á‡∏Ñ‡πå</h3>
            <input type='text' id='goal' placeholder='‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢'></input>
            <input type='number' id='amount' placeholder='‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô'></input>
            <div class="row">
                <div class="col-6">
                    <label for="Inputstartdate">‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                    <input type='date' id='startdate'></input>
                </div>
                <div class="col-6">
                    <label for="inputenddate">‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                    <input type='date' id='enddate'></input>
                </div>
            </div>
            <label for="inputfrequency">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà</label>
            <select id="frequency" class="form-control">
                <option value="‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</option>
                <option value="‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå">‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</option>
                <option value="‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option>
            </select><br>
            <button onclick="addItem()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            <button id="backbtn"onclick="mockupClick('page-setting','page-home')">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
        </div>

        <div id="page-saving" class="page">
            <h1 id='curgoal' class="text-center"></h1>
            <div class="row">
                <div class="col-6">
                    <div id='showdate'></div>
                    <div id='day_count'></div>
                </div>
                <p id='countdowndate' class="text-right col-6"></p>
            </div>

            <div class="saving">
                <small>‡∏¢‡∏≠‡∏î‡πÄ‡∏Å‡πá‡∏ö/‡∏Ñ‡∏£‡∏±‡πâ‡∏á</small>
                <h1 id='saving_amount' style="color: #7CB342;"></h1><small id='showfrequency'></small>
            </div>

            <div class="detail">
                <div class="progress">
                    <div id='progress_bar' class="progress-bar progress-bar-striped bg-success" role="progressbar"
                        aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">7%</div>
                </div>
                <div class="row">
                    <div id='store_amount' class="col-6"></div>
                    <div id="goal_amount" class="col-6" style="text-align:right;"></div>
                </div>
            </div>
            <button onclick="mockupClick('page-saving','page-home')">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
        </div>
    </div>
    <div class="footer text-right mt-2 p-2 text-dark text-center">
        <small>*‡πÄ‡∏®‡∏©‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</small><br />
        <!-- <small>KepTung by ckrittima</small> -->
        <small>KepTung by <a href="https://web.facebook.com/aomxsyn" style="color:#13A699">aomsyn</a> üßÉ</small>
    </div>

    <script>
        if (localStorage.getItem("allGoals") === null){
            localStorage.setItem("allGoals", "[]");
        }
        allGoals = JSON.parse(localStorage.allGoals);

        function addItem(){
            let title = document.getElementById("goal").value;
            let amount = document.getElementById("amount").value;
            let startdate = document.getElementById("startdate").value;
            let enddate = document.getElementById("enddate").value;
            let freq = document.getElementById('frequency').value;
            if (title != "" && amount > 0 && startdate != "" && enddate != "" && freq != ""){
                allGoals.push({"title": title, "amount": amount, "frequency": freq, "startDate": startdate, "endDate": enddate});
                calculate();
                document.getElementById("goal").value = "";
                document.getElementById("amount").value = "";
                document.getElementById("startdate").value = "";
                document.getElementById("enddate").value = "";
                document.getElementById('frequency').value = "";
                displayGoal()
            }
        }
        // <div id="goal_item" class="row" ondblclick="removeGoal(${element.index-1})">
        function displayGoal(){
            allGoals.forEach(element => {
                console.log(element.title);
                list_goal.innerHTML += `
				<div id="goal_item" class="row" ondblclick="removeGoal(${element.index-1})" onclick="showdetail()">
                    <div class="col-6">
                    <h3>${element.title}</h3>
                    <small>${element.frequency}</small>
                    </div>
                    <div class="col-6"><h3 class="text-right">${element.amount}</h3>
				</div>
                `;
            });
            console.log(allGoals);
			localStorage.setItem("allGoals", JSON.stringify(allGoals));
        }
        displayGoal()

        function removeGoal(index){
			remove = allGoals.splice(index, 1);
            displayGoal();
		}

        let date = new Date();
        document.getElementById("startdate").max = `${date.getFullYear()}-${date.getMonth()}-${date.getDay()}`;
        document.getElementById("enddate").min = new Date();


        function mockupClick(pageToHide, pageToShow) {
            document.querySelector('#' + pageToHide).style.display = "none ";
            document.querySelector('#' + pageToShow).style.display = "block ";
        }

        function calculate() {
            var amount = document.getElementById('amount').value;
            var startdate = document.getElementById('startdate').value;
            var enddate = document.getElementById('enddate').value;
            var freq = document.getElementById('frequency').value;

            var date1 = new Date(startdate);
            var date2 = new Date(enddate);
            var time_dif = date2.getTime() - date1.getTime();
            var day_diff = (time_dif / (1000 * 3600 * 24))+1;

            let saving_amount = 0;
            if (freq == '‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô') {
                saving_amount = Math.ceil(amount / day_diff);
            } else if (freq == '‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå') {
                let weekly = Math.ceil(day_diff / 7);
                console.log("weekly", weekly);
                saving_amount = Math.ceil(amount / weekly);
                console.log(day_diff);
                console.log(weekly);
                console.log(saving_amount); 
            } else if (freq == '‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô') {
                let monthly = day_diff / 30;
                saving_amount = Math.ceil(amount / monthly);
            }
            document.getElementById('saving_amount').innerHTML = saving_amount;
            calPercent(saving_amount)
            showdetail();
            mockupClick('page-setting', 'page-saving');
        }

        function getInputDate(){
            var startD = document.getElementById('startdate').value;
            var endD = document.getElementById('enddate').value;
            CalMonthDiff(new Date(startD), new Date(endD));
        }

        function CalMonthDiff(d1, d2){
            var months;
            months = (d2.getFullYear() - d1.getFullYear()) * 12;
            months -= d1.getMonth();
            months += d2.getMonth();
            return months <= 0 ? 0 : months;
        }

        function calPercent(saving_amount) {
            var amount = document.getElementById('amount').value;
            var startdate = document.getElementById('startdate').value;
            var enddate = document.getElementById('enddate').value;
            var freq = document.getElementById('frequency').value;
            console.log(freq);

            var c_date = new Date();
            var e_date = new Date(enddate);
            var currentDate = c_date.getDate() + '/' + (c_date.getMonth() + 1) + '/' + c_date.getFullYear();
            var s_date = new Date(startdate);
            var t_dif = c_date.getTime() - s_date.getTime();
            var t_diff2 = e_date.getTime() - c_date.getTime();
            // console.log(t_diff2)
            var day_count = (t_dif / (1000 * 3600 * 24)+1);
            var week_count = ((t_dif / (1000 * 3600 * 24))/7)+1;
            var month_count = ((t_dif / (1000 * 3600 * 24))/30);

            console.log("day_count", day_count);
            console.log("week_count", week_count);
            console.log("month_count", month_count);

            var remain_day = t_diff2 / (1000 * 3600 * 24);
            var remain_week = remain_day/7;
            var remain_month = remain_day/30;
            console.log("remain_day", remain_day);
            console.log("remain_week", remain_week);
            console.log("remain_month", remain_month);
            var store_amountd = saving_amount * parseInt(day_count);
            var store_amountw = saving_amount * parseInt(week_count);
            var store_amountm = saving_amount * parseInt(month_count);

            if(freq == "‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô"){
                var percent = ((store_amountd / amount) * 100).toFixed(0);
                document.getElementById('store_amount').innerHTML = parseInt(store_amountd);
                document.getElementById('day_count').innerHTML = '<p>D-' + day_count.toFixed(0) + '</p>';
                if (remain_day < 0){
                    remain_day = 0;
                    document.getElementById('countdowndate').innerHTML = '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å <br>' + remain_day.toFixed(0) + ' ‡∏ß‡∏±‡∏ô';
                } else {
                    document.getElementById('countdowndate').innerHTML = '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å <br>' + remain_day.toFixed(0) + ' ‡∏ß‡∏±‡∏ô';
                }
            } else if(freq == "‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå"){
                var percent = ((store_amountw / amount) * 100).toFixed(0);
                document.getElementById('store_amount').innerHTML = parseInt(store_amountw);
                document.getElementById('day_count').innerHTML = '<p>W-' + week_count.toFixed(0) + '</p>';
                if (remain_day < 0){
                    remain_day = 0;
                    document.getElementById('countdowndate').innerHTML = '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å <br>' + remain_week.toFixed(0) + ' ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå';
                } else {
                    document.getElementById('countdowndate').innerHTML = '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å <br>' + remain_week.toFixed(0) + ' ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå';
                }
            } else if(freq == "‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"){
                var percent = ((store_amountm / amount) * 100).toFixed(0);
                document.getElementById('store_amount').innerHTML = parseInt(store_amountm);
                document.getElementById('day_count').innerHTML = '<p>M-' + month_count.toFixed(0) + '</p>';
                if (remain_day < 0){
                    remain_day = 0;
                    document.getElementById('countdowndate').innerHTML = '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å <br>' + remain_month.toFixed(0) + ' ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô';
                } else {
                    document.getElementById('countdowndate').innerHTML = '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å <br>' + remain_month.toFixed(0) + ' ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô';
                }
            
            document.getElementById('progress_bar').style.width = percent + '%';
            document.getElementById('progress_bar').innerHTML = percent + '%';
            
            }
        }

        function showdetail() {
            var title = document.getElementById('goal').value;
            var amount = document.getElementById('amount').value;
            var freq = document.getElementById('frequency').value;
            document.getElementById('curgoal').innerHTML = title;
            document.getElementById('showfrequency').innerHTML = '(' + freq + ')';
            document.getElementById('goal_amount').innerHTML = amount;
        }

        function getNowDate() {
            var d = new Date();
            var currentDate = new Date();
            var day = currentDate.getDate();
            var month = currentDate.getMonth() + 1;
            var year = currentDate.getFullYear();
            document.getElementById('showdate').innerHTML = day + "/" + month + "/" + year;
        }
        getNowDate()
    </script>
</body>

</html>